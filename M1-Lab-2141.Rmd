---
title: "M1 Lab"
author: "Ally Tirendi"
date: "09/11/2025"
output:
  html_document:
    df_print: paged
    toc: true
    number_sections: false
    toc_depth: '3'
    code_folding: show
---


```{r,echo=FALSE,message=FALSE,warning=FALSE}
# this is a set-up chunk
# DON'T CHANGE THESE SETTINGS--I'VE SET THEM UP TO MAKE THINGS RUN SMOOTHLY 
require(knitr)
knitr::opts_chunk$set(echo = TRUE, error = TRUE, 
                      root.dir = rprojroot::find_rstudio_root_file())

knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())


```

# Load Libraries and Import Data Set

```{r}
library(tidyverse) # package for plotting/data management
```

```{r}
ra <- read_csv(file = "Data/ArthritisTreatment.csv")
# read in data


```

# Part 1: Creating New Factors and Dropping Missing Data

```{r}
# Creating New Factor Variables
ra = ra %>%
    mutate(
      DAS28_YN_f = factor(DAS28_YN, 
                        levels = c(1,2), 
                        labels = c("no","yes")),
      Sex_f = factor(Sex,
                   levels = c(0,1),
                   labels = c("female", "male")),
      Biologics_f = factor(Biologics,
                         levels = c(0,1),
                         labels = c("no", "yes"))
  )
  
# Dropping Rows With Missing Values  
ra = ra %>% 
  drop_na(DAS28_YN_f, Sex_f, Age, Yrs_From_Dx, Biologics_f)


```



# Part 2: Univariate Numerical and Visualization Summaries


## Sex

```{r}

# summary statistics
ra %>%
  group_by(Sex_f) %>%
  summarise(f = n()) %>%
  mutate(phat = round(f/ sum(f), digits = 3))
  


# visualization
ra %>%
  ggplot(aes(x = Sex_f)) +
  geom_bar() +
  labs(x = "Sex") +
  theme_bw()

```

In the data, there was 417 females and 98 males included that did not have missing data, so approximately 81% of the data studied were female patients and roughly 19% were male patients. The bar chart shows a much higher count for females than for the males, almost by 4 fold.


## Age  

```{r}

# summary statistics
ra %>% drop_na(Age) %>%
    summarise(mean = mean(Age),
              median = median(Age),
              min = min(Age),
              max = max(Age),
              q25 = quantile(Age,.25),
              q75 = quantile(Age,.75),
              var = var(Age),
              sd = sd(Age)) %>%
    mutate(IQR = q75 - q25,
           range = max - min)


# visualization
ra %>%
  drop_na(Age) %>%
  ggplot(aes(x = Age)) +
  geom_histogram(bins = 50) +
    theme_bw()

```


From the histogram, the distribution is slightly skewed to the right meaning our mean age will be slightly larger than the median age. The median Age of the patients studied was 59 years old, and the IQR of the data is 12 with a standard deviation of 10.2 years.


## Whether DAS_28 was measured 

```{r}
 
# summary statistics
ra %>% 
  group_by(DAS28_YN_f) %>%
  summarise(f = n()) %>%
  mutate(phat = round(f/ sum(f), digits = 3))
  


# visualization
ra %>%
  ggplot(aes(x = DAS28_YN_f)) +
  geom_bar() +
  labs(x = "DAS_28 Measured") +
  theme_bw()

```

Considering the data, excluding rows with missing data, there was 449 patients who did not have DAS_28 measured and 66 patients who did have their DAS_28 measured. So, approximately 87% of patients did not have their DAS_28 measured, while 13% did have their DAS_28 measured. The bar chart shows a much higher count for patients who did not have their DAS_28 measured, than for the ones who did.

## DAS_28 values

```{r}
# summary stats
ra %>% drop_na(DAS_28) %>%
  summarise(mean = mean(DAS_28),
            median = median(DAS_28),
            min = min(DAS_28),
            max = max(DAS_28),
            q25 = quantile(DAS_28,.25),
            q75 = quantile(DAS_28,.75),
            var = var(DAS_28),
            sd = sd(DAS_28)) %>%
  mutate(IQR = q75 - q25,
         range = max - min)

# visualization
ra %>% drop_na(DAS_28) %>%
  ggplot(aes(y = DAS_28)) +
  geom_boxplot() +
  theme_bw()
```

From the boxplot, DAS_28 is skewed to the right. The median DAS_28 measured from the patients studied was 2.5 joints. The IQR of the data was 1.48 with a standard deviation of 2.77 joints. The maximum (possible outlier) of the patients studied had a disease score activity of 23 joints, meaning this patient suffered a more severe disease compared to the average.


## Years from diagnosis

```{r}

# summary statistics
ra %>% drop_na(Yrs_From_Dx) %>%
  summarise(mean = mean(Yrs_From_Dx),
            median = median(Yrs_From_Dx),
            min = min(Yrs_From_Dx),
            max = max(Yrs_From_Dx),
            q25 = quantile(Yrs_From_Dx,.25),
            q75 = quantile(Yrs_From_Dx,.75),
            var = var(Yrs_From_Dx),
            sd = sd(Yrs_From_Dx)) %>%
  mutate(IQR = q75 - q25,
         range = max - min)
    

# visualization
ra %>% drop_na(Yrs_From_Dx) %>%
  ggplot(aes(x = Yrs_From_Dx)) +
  geom_histogram(bins = 80) +
  labs(x = "Years From RA Diagnosis") +
  theme_bw()

```

From the histogram, the Years from RA diagnosis is heavily skewed to the right. The median Years from RA diagnosis measured was 7 years. The IQR of the data was 8 years with a standard deviation of 9.29 years. The maximum (possible outlier) years from diagnosis of the patients studied was recorded at 70 years, meaning this patient was diagnosis much later than other patients.

# Part 3: Bivariate Numerical and Visualization Summary  

## Years from Diagnosis and DAS 28


```{r}

# visualization
ra %>%
  ggplot(aes(x = Yrs_From_Dx, y = DAS_28)) +
  geom_point() +
  theme_bw()
# numeric summary
cor(ra$Yrs_From_Dx, ra$DAS_28, use = "pairwise.complete.obs")
cor(ra$Yrs_From_Dx, ra$DAS_28, use = "pairwise.complete.obs", method = "spearman")
```

For both the Pearson and Spearman Correlations, the values are very close to 0. The Pearson Correlation is at approximately -0.08 and the Spearman Correlation is at approximately 0.13, meaning the variables, years since diagnosis and the disease severity measured have little to no association or relationship to one another.  


## Possible problematic points


```{r}
# problematic points
ra_wo286 = ra %>% 
  filter(ID != 286)

ra_wo286 %>%
  ggplot(aes(x = Yrs_From_Dx, y = DAS_28)) +
  geom_point() +
  theme_bw()

cor(ra_wo286$Yrs_From_Dx, ra_wo286$DAS_28, use = "pairwise.complete.obs")
cor(ra_wo286$Yrs_From_Dx, ra_wo286$DAS_28, use = "pairwise.complete.obs", method = "spearman")
```

Yes, there was a data point I was concerned about that I wanted to take another look at. If I excluded that point from the analysis, the Pearson Correlation would increase, and my Spearman Correlation would also slightly increase, meaning without the problematic point I would see a slightly greater association between the years since diagnosis and disease severity, however, it is still a weak association.


## Whether DAS_28 was measured and years from diagnosis


```{r}
# summary stats
ra %>%
  drop_na(Yrs_From_Dx, DAS28_YN_f) %>%
  group_by(DAS28_YN_f) %>%
  summarise(n = n(),
            mean = mean(Yrs_From_Dx),
            mediam = median(Yrs_From_Dx),
            min = min(Yrs_From_Dx),
            max = max(Yrs_From_Dx),
            q25 = quantile(Yrs_From_Dx,.25),
            q75 = quantile(Yrs_From_Dx,.75),
            var = var(Yrs_From_Dx),
            sd = sd(Yrs_From_Dx)) %>%
  mutate(IQR = q75 - q25,
         range = max-min)

# visualization(s)
ra %>%
  ggplot(aes(y = Yrs_From_Dx, x= DAS28_YN_f)) +
  geom_boxplot() +
  geom_jitter(aes(color = DAS28_YN_f), alpha = 0.5) +
  labs(x = "DAS_28 Measured") +
  theme_classic() +
  theme(legend.position = "none")
```

The boxplots for individuals who did and did not have their DAS_28 measured are similar to each other with a difference, but not one of any significant note. Both boxplots are skewed to the right, meaning both of their means are greater than the medians. For both factors of DAS_28 measured, there are significantly higher counts of individuals from 0 to 20 years since diagnosis than compared to 20 years or more. Since there is a problematic point present the individuals who did not have their DAS_28 measured, we also see a slightly higher variance and standard deviation for this group compared to those who did have their DAS_28 measured.



## d) Whether DAS_28 was measured and use of biologics


```{r}
# numeric summary
tab = xtabs( ~ DAS28_YN_f + Biologics_f, data = ra)
prop_tab = prop.table(tab, margin = 2)
tab

#difference in proportion taking/not taking biologics having DAS_28 measured
diff1 = prop_tab["yes","yes"] - prop_tab["yes", "no"]

#difference in proportion taking/not taking biologics NOT having DAS_28 measured
diff2 = prop_tab["no", "yes"] - prop_tab["no", "no"]

print(diff1)
print(diff2)

# visualization
ra %>%
  drop_na(Biologics_f,DAS28_YN_f) %>%
  ggplot(aes(x = Biologics_f, fill = DAS28_YN_f)) +
  geom_bar(position = "fill") +
  labs(x = "Have Taken Biologics", y = "Percent", fill = "Disease Severity Measured") +
  theme_bw()
```

From the difference in proportions and the bar chart, there is once again a difference, but not one of significant note between individuals who did not take biologics and whether or not their disease score was measured, as the difference is 0.055 which is ~5.5%. We can see there are similar proportions between the individuals who had or did not have their disease score measured for biologic groups.





# Summary of Findings

Rheumatoid Arthritis is a serious condition that impacts many individuals. The data in this study was collected as a cross-sectional observational study, from patients in two age ranges (40-70, 75+) at a clinic in Philadelphia. Patients with a specific history were excluded from the study to mitigate confounding variables. There was a substantial amount of missing data in the study leading us to draw conclusions on incomplete data. Some trends I found within the data was there was much large proportion of females to males within the study as well as a large amount of patients who did not have their disease severity score measured compared to those who did have their disease score measured. However, there were weak associations between if DAS_28 was measured compared to the years since diagnosis and if biologics were used. Overall, when interpreting the results, I would warn my audience to consider the vast amount of missing data and how it could potentially lead to bias making the results from our data unable to be generalized to the general population of RA patients.


