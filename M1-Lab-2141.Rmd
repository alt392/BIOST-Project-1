---
title: "Rheumatoid Arthritis Analysis"
author: "Ally Tirendi"
date: "09/11/2025"
output:
  html_document:
    df_print: paged
    toc: true
    number_sections: false
    toc_depth: '3'
    code_folding: show
---


```{r,echo=FALSE,message=FALSE,warning=FALSE}
# this is a set-up chunk
# DON'T CHANGE THESE SETTINGS--I'VE SET THEM UP TO MAKE THINGS RUN SMOOTHLY 
require(knitr)
knitr::opts_chunk$set(echo = TRUE, error = TRUE, 
                      root.dir = rprojroot::find_rstudio_root_file())

knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())


```

# Load Libraries and Import Data Set

```{r}
library(tidyverse) # package for plotting/data management
```

```{r}
ra <- read_csv(file = "Data/ArthritisTreatment.csv")
# read in data


```

# Part 1: Creating New Factors and Dropping Missing Data

```{r}
# Creating New Factor Variables
ra = ra %>%
    mutate(
      DAS28_YN_f = factor(DAS28_YN, 
                        levels = c(1,2), 
                        labels = c("no","yes")),
      Sex_f = factor(Sex,
                   levels = c(0,1),
                   labels = c("female", "male")),
      Biologics_f = factor(Biologics,
                         levels = c(0,1),
                         labels = c("no", "yes"))
  )
  
# Dropping Rows With Missing Values  
ra = ra %>% 
  drop_na(DAS28_YN_f, Sex_f, Age, Yrs_From_Dx, Biologics_f)


```



# Part 2: Univariate Numerical and Visualization Summaries


## Sex

```{r}

# summary statistics
ra %>%
  group_by(Sex_f) %>%
  summarise(f = n()) %>%
  mutate(phat = round(f/ sum(f), digits = 3))
  


# visualization
ra %>%
  ggplot(aes(x = Sex_f)) +
  geom_bar() +
  labs(x = "Sex") +
  theme_bw()

```



## Age  

```{r}

# summary statistics
ra %>% drop_na(Age) %>%
    summarise(mean = mean(Age),
              median = median(Age),
              min = min(Age),
              max = max(Age),
              q25 = quantile(Age,.25),
              q75 = quantile(Age,.75),
              var = var(Age),
              sd = sd(Age)) %>%
    mutate(IQR = q75 - q25,
           range = max - min)


# visualization
ra %>%
  drop_na(Age) %>%
  ggplot(aes(x = Age)) +
  geom_histogram(bins = 50) +
    theme_bw()

```




## Whether DAS_28 was measured 

```{r}
 
# summary statistics
ra %>% 
  group_by(DAS28_YN_f) %>%
  summarise(f = n()) %>%
  mutate(phat = round(f/ sum(f), digits = 3))
  


# visualization
ra %>%
  ggplot(aes(x = DAS28_YN_f)) +
  geom_bar() +
  labs(x = "DAS_28 Measured") +
  theme_bw()

```


## DAS_28 values

```{r}
# summary stats
ra %>% drop_na(DAS_28) %>%
  summarise(mean = mean(DAS_28),
            median = median(DAS_28),
            min = min(DAS_28),
            max = max(DAS_28),
            q25 = quantile(DAS_28,.25),
            q75 = quantile(DAS_28,.75),
            var = var(DAS_28),
            sd = sd(DAS_28)) %>%
  mutate(IQR = q75 - q25,
         range = max - min)

# visualization
ra %>% drop_na(DAS_28) %>%
  ggplot(aes(y = DAS_28)) +
  geom_boxplot() +
  theme_bw()
```



## Years from diagnosis

```{r}

# summary statistics
ra %>% drop_na(Yrs_From_Dx) %>%
  summarise(mean = mean(Yrs_From_Dx),
            median = median(Yrs_From_Dx),
            min = min(Yrs_From_Dx),
            max = max(Yrs_From_Dx),
            q25 = quantile(Yrs_From_Dx,.25),
            q75 = quantile(Yrs_From_Dx,.75),
            var = var(Yrs_From_Dx),
            sd = sd(Yrs_From_Dx)) %>%
  mutate(IQR = q75 - q25,
         range = max - min)
    

# visualization
ra %>% drop_na(Yrs_From_Dx) %>%
  ggplot(aes(x = Yrs_From_Dx)) +
  geom_histogram(bins = 80) +
  labs(x = "Years From RA Diagnosis") +
  theme_bw()

```


# Part 3: Bivariate Numerical and Visualization Summary  

## Years from Diagnosis and DAS 28


```{r}

# visualization
ra %>%
  ggplot(aes(x = Yrs_From_Dx, y = DAS_28)) +
  geom_point() +
  theme_bw()
# numeric summary
cor(ra$Yrs_From_Dx, ra$DAS_28, use = "pairwise.complete.obs")
cor(ra$Yrs_From_Dx, ra$DAS_28, use = "pairwise.complete.obs", method = "spearman")
```



## Possible problematic points


```{r}
# problematic points
ra_wo286 = ra %>% 
  filter(ID != 286)

ra_wo286 %>%
  ggplot(aes(x = Yrs_From_Dx, y = DAS_28)) +
  geom_point() +
  theme_bw()

cor(ra_wo286$Yrs_From_Dx, ra_wo286$DAS_28, use = "pairwise.complete.obs")
cor(ra_wo286$Yrs_From_Dx, ra_wo286$DAS_28, use = "pairwise.complete.obs", method = "spearman")
```



## Whether DAS_28 was measured and years from diagnosis


```{r}
# summary stats
ra %>%
  drop_na(Yrs_From_Dx, DAS28_YN_f) %>%
  group_by(DAS28_YN_f) %>%
  summarise(n = n(),
            mean = mean(Yrs_From_Dx),
            mediam = median(Yrs_From_Dx),
            min = min(Yrs_From_Dx),
            max = max(Yrs_From_Dx),
            q25 = quantile(Yrs_From_Dx,.25),
            q75 = quantile(Yrs_From_Dx,.75),
            var = var(Yrs_From_Dx),
            sd = sd(Yrs_From_Dx)) %>%
  mutate(IQR = q75 - q25,
         range = max-min)

# visualization(s)
ra %>%
  ggplot(aes(y = Yrs_From_Dx, x= DAS28_YN_f)) +
  geom_boxplot() +
  geom_jitter(aes(color = DAS28_YN_f), alpha = 0.5) +
  labs(x = "DAS_28 Measured") +
  theme_classic() +
  theme(legend.position = "none")
```




## d) Whether DAS_28 was measured and use of biologics


```{r}
# numeric summary
tab = xtabs( ~ DAS28_YN_f + Biologics_f, data = ra)
prop_tab = prop.table(tab, margin = 2)
tab

#difference in proportion taking/not taking biologics having DAS_28 measured
diff1 = prop_tab["yes","yes"] - prop_tab["yes", "no"]

#difference in proportion taking/not taking biologics NOT having DAS_28 measured
diff2 = prop_tab["no", "yes"] - prop_tab["no", "no"]

print(diff1)
print(diff2)

# visualization
ra %>%
  drop_na(Biologics_f,DAS28_YN_f) %>%
  ggplot(aes(x = Biologics_f, fill = DAS28_YN_f)) +
  geom_bar(position = "fill") +
  labs(x = "Have Taken Biologics", y = "Percent", fill = "Disease Severity Measured") +
  theme_bw()
```



